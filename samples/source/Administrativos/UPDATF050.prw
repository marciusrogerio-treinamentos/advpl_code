#INCLUDE "PROTHEUS.CH"
#INCLUDE "TBICONN.CH"
#INCLUDE "FILEIO.CH"
#INCLUDE "apwizard.ch"  
#INCLUDE 'FWBROWSE.CH'

#DEFINE X3_USADO_EMUSO "€€€€€€€€€€€€€€ "
#DEFINE X3_USADO_NAOUSADO "€€€€€€€€€€€€€€€"   
#DEFINE X3_OBRIGAT "Á€" 
#DEFINE X3_NAOOBRIGAT "šÀ"
#DEFINE X3_RESER "šA"

#DEFINE PULALINHA CHR(13)+CHR(10)

Static aPerg := {}
Static aResp := {}

/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Funcao    ³ UPATF050 ³ Autor Felipe Cunha  	      	³ Data ³ 01/04/14 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descricao ³ 															        ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ UPATF050                                                   ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
User Function UPDATF050()

Local lGravouLog 		:= .F.
Local oOk        		:= LoadBitmap( GetResources(), "LBOK" )
Local oNOk       		:= LoadBitmap( GetResources(), "LBNO" )

Private cApresenta 	:= ''
Private cLogUpdate 	:= ''

Private lConcordo  	:= .F.

Private lChkTerm		:= .F.

Private aSelFil := {}

//-----------------------------------------------------
//Mensagem de Apresentação                             
//-----------------------------------------------------                
cApresenta := "O procedimento de actualização ajustará os registros das tabelas de Movimentos do Ativo(SN4) e Tipos de Ativos(SN3) gerados pela rotina de Calculo mensal(ATFA050)."


//-----------------------------------------------------
//Termo de Aceite
//-----------------------------------------------------
cTerAceite := "Antes que sua atualização inicie, você deve ler e aceitar os termos e as condições a seguir. Após aceitá-los, você pode prosseguir com a atualização." + PULALINHA	//"Antes que sua atualização inicie, você deve ler e aceitar os termos e as condições a seguir. Após aceitá-los, você pode prosseguir com a atualização."
cTerAceite += PULALINHA


//-----------------------------------------------------
// Desliga Refresh no Lock do Top
//-----------------------------------------------------
#IFDEF TOP
	TCInternal(5,'*OFF') 
#ENDIF

//-----------------------------------------------------
// Painel 1 - Tela inicial do Wizard 		            
//-----------------------------------------------------
oWizard := APWizard():New("Wizard Atualização Movimentos do Ativo Fixo"/*<chTitle>*/,; // "Wizard Atualização Movimentos do Ativo Fixo"
                          	/* <.chMsg.>    */ "",;
                          	/* <.cTitle.>   */ "",;
								/* <.cText.>    */ cApresenta ,; 
								/* <.bNext.>    */ {||.T.},;
								/* <.bFinish.>  */ {||.T.},;
								/* <.lPanel.>   */ .F.,;
								/* <.cResHead.> */ ,;
								/* <.bExecute.> */ ,; 
								/* <.lNoFirst.> */ ,;
								/* <aCoord.>	  */)
								
//-----------------------------------------------------
// Painel 2 - Termo de Aceite         
//-----------------------------------------------------
oWizard:NewPanel(	/*<chTitle> */ "Termo de Aceite" ,;
					/*<chMsg>   */ "Antes que sua atualização inicie, você deve ler e aceitar os termos e as condições a seguir. Após aceitá-los, você pode prosseguir com a atualização.",; // "Antes que sua atualização inicie, você deve ler e aceitar os termos e as condições a seguir. Após aceitá-los, você pode prosseguir com a atualização."
					/*<bBack>   */ {||.T.},;
					/*<bNext>   */ {||lChkTerm},;
					/*<bFinish> */ {||.T.},;
					/*<.lPanel.>*/ .F.    ,;
					/*<bExecute>*/ {|| UpdAtfP2()})
					
//-----------------------------------------------------
// Painel 3 - Parametros       
//-----------------------------------------------------
oWizard:NewPanel(	/*<chTitle> */ "Parametros" 	,;
					/*<chMsg>   */ ""					,;
					/*<bBack>   */ {||.T.}			,;
					/*<bNext>   */ {||UpdAtfPros(),.T.}	,;
					/*<bFinish> */ {||.T.}			,;
					/*<.lPanel.>*/ .T.    			,;
					/*<bExecute>*/ {|| UpdAtfP3()})
					
//-----------------------------------------------------
// Painel 4 - Processamento       
//-----------------------------------------------------
oWizard:NewPanel(	/*<chTitle> */ "Confirma Processamento" ,;
					/*<chMsg>   */ ,;
					/*<bBack>   */ {||.T.},;
					/*<bNext>   */ {||.T.},;
					/*<bFinish> */ {||UpdAtfTOk()},;
					/*<.lPanel.>*/ .T.    ,;
					/*<bExecute>*/ {|| UpdAtfP4()})
								
oWizard:Activate(	.T./*<.lCenter.>*/,;
					 	{ || .T. }/*<bValid>*/, ;
						{ || .T. }/*<bInit>*/, ;
						{ || .T. }/*<bWhen>*/ )

Return


/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³UpdAtfTerm  ºAutor  ³Felipe Cunha       º Data ³  01/04/14  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Termo de Aceite											  		 º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function UpdAtfP2()
Local oPanel		:= Nil
Local oCheckTerm
Local oScrolTerm
Local bTerm 


bTerm := {|| 	"     Antes que sua atualização inicie, você deve ler e aceitar os termos e as condições a seguir." 	+; 
				" Após aceitá-los, você pode prosseguir com a atualização."                                         	+;
				PULALINHA 																											+;
				PULALINHA 																											+;
				"ATENÇÃO: LEIA COM ATENÇÃO ANTES DE PROSSEGUIR COM A ATUALIZAÇÃO" 											+;
				PULALINHA 																											+;
				PULALINHA                 																						+;
				"ACORDO DE LICENÇA DE SOFTWARE PARA USUÁRIO FINAL ('ACORDO')" 												+;
				PULALINHA 																											+;
				PULALINHA                 																						+;
				"TERMOS E CONDIÇÕES"                                                                                 	+;
				PULALINHA                 																						+;
				"ADVERTÊNCIAS LEGAIS: AO CLICAR NA OPÇÃO 'SIM, LI E ACEITO O TERMO ACIMA' NO FINAL DESTA JANELA,"    	+; 
				" VOCÊ INDICA QUE LEU E CONCORDOU COM TODOS OS TERMOS DESTE ACORDO E QUE CONSENTE EM SER REGIDO POR" 	+;
				" ESTE ACORDO E TORNAR-SE PARTE DELE.  A TOTVS ESTÁ DISPOSTA A DISPONIBILIZAR ESTE AJUSTE PARA VOCÊ" 	+;
				" APENAS SOB A CONDIÇÃO DE QUE VOCÊ CONCORDE COM TODOS OS TERMOS CONTIDOS NESTE ACORDO. SE VOCÊ NÃO"	+;
				" CONCORDA COM TODOS OS TERMOS DESTE ACORDO, CLIQUE NO BOTÃO 'CANCELAR' E NÃO PROSSIGA COM O AJUSTE."	+;
				PULALINHA 																											+;
				"O ACORDO A SEGUIR É UM ACORDO LEGAL ENTRE VOCÊ (O USUÁRIO FINAL, SEJA UM INDIVÍDUO OU ENTIDADE),"	+;
				" E A TOTVS S/A. (PROPRIAMENTE DITA OU SUAS LICENCIADAS). " 												+;
				PULALINHA                 																						+;
				"ESTE SOFTWARE É LICENCIADO PELA TOTVS PARA VOCÊ, E QUALQUER RECEPTOR SUBSEQÜENTE DO SOFTWARE,"		+; 
				" SOMENTE PARA USO SEGUNDO OS TERMOS ESTABELECIDOS NESTE DOCUMENTO. " 									+;
				PULALINHA 																											+;
				PULALINHA                 																						+;
				"PREMISSAS DE UTILIZAÇÃO: Antes de executar esta rotina é obrigatória a realização de uma cópia de" 	+;
				" segurança geral do sistema Protheus (binário, RPO, dicionários SXs e banco de dados). Faça testes" 	+;
				" de performance e planeje-se antes de executar esta atualização, pois ela requer acesso exclusivo" 	+;
				" às tabelas do sistema (ou seja: nenhum usuário poderá acessar o sistema) durante toda a sua"			+;
				" execução, que pode demorar várias horas para ser finalizada! Depois de iniciada esta rotina não"	+;
				" poderá ser interrompida! Qualquer tipo de interrupção (ex.:falta de energia, problemas de hardware"	+;
				" , problemas de rede, etc.) poderá danificar todo o sistema! Neste caso deve-se realizar a"			+;
				" restauração da cópia de segurança feita imediatamente antes do inicio da atualização antes de" 		+;
				" executá-la novamente." 																						+;
				PULALINHA 																											+;
				PULALINHA                 																						+;
				"CONCESSÃO DE LICENÇA: A TOTVS lhe concede uma licença limitada, não-exclusiva e revogável para usar"	+;
				" a versão de código executável da Atualização do módulo Ativo Fixo denominada UPDATF050,"	+;
				" eximindo-se de qualquer dado resultante da utilização deste." 											+;
				PULALINHA 																											+;
				PULALINHA 																											+;  
				"DIREITOS AUTORAIS: O Software é propriedade da TOTVS e está protegido por leis de direitos autorais"	+;
				" do Brasil e disposições de tratados internacionais.  Você reconhece que não lhe será transferido"	+;
				" qualquer direito a qualquer propriedade intelectual do Software. " 										+;
				PULALINHA 																											+;
				PULALINHA 																											+;
				"LIMITAÇÕES: Exceto se explicitamente disposto em contrário neste Acordo, você não pode:"				+;
				PULALINHA 																											+;
				"a) modificar o Software ou criar trabalhos derivados do mesmo; "											+;
				PULALINHA 																											+;
				"b) descompilar, desmontar, fazer engenharia reversa, ou de outras maneiras tentar alterar o código"	+;
				"-fonte do Software;"																							+;
				PULALINHA 																											+;
				"c) copiar (exceto para fazer uma cópia de backup), redistribuir, impedir, vender, alugar, arrendar"	+;
				", sublicenciar, atribuir ou de outras maneiras transferir seus direitos ao Software; ou " 			+;
				PULALINHA 																											+;				
				"d) remover ou alterar qualquer marca registrada, logotipo, registro ou outras advertências"			+;
				" proprietárias no Software.  Você pode transferir todos os seus direitos ao Software regidos por"	+;
				" este Acordo para outra pessoa transferindo-lhe, permanentemente, o computador pessoal no qual o"	+;
				" Software está instalado, contanto que você não retenha nenhuma cópia do Software e que o receptor"	+;
				" concorde com todos os termos deste Acordo. " 																+;
				PULALINHA 																											+;
				PULALINHA 																											+;
				"ATIVIDADES DE ALTO RISCO: O Software não é tolerante a falhas e não foi projetado, fabricado ou"		+;
				" desenvolvido para uso em ambientes perigosos que requerem desempenho à prova de falhas, como na"	+;
				" operação de instalações nucleares, navegação de aeronaves ou sistemas de comunicação, controle de"	+;
				" tráfego aéreo, dispositivos médicos implantados em seres humanos, máquinas externas de suporte à"	+;
				" vida humana, dispositivos de controle de explosivos, submarinos, sistemas de armas ou controle de"	+;
				" operação de veículos motorizados nos quais a falha do Software poderia levar diretamente à morte,"	+;
				" danos pessoais ou danos físicos ou ambientais graves ('Atividades de Alto Risco'). Você concorda"	+;
				" em não usar o Software em Atividades de Alto Risco. " 													+;
				PULALINHA 																											+;
				PULALINHA 																											+;
				"RENÚNCIA ÀS GARANTIAS: A TOTVS não garante que o Software satisfará suas exigências, que a operação"	+;
				" do mesmo será ininterrupta ou livre de erros, ou que todos os erros de Software serão corrigidos."	+;
				" Todo o risco no que se refere à qualidade e ao desempenho do Software decorre por sua conta."		+;
				PULALINHA 																											+;
				PULALINHA 																											+;
				"O SOFTWARE É FORNECIDO 'COMO ESTÁ' E SEM GARANTIAS DE QUALQUER TIPO, EXPRESSAS OU IMPLÍCITAS,"		+;
				" INCLUINDO, MAS NÃO SE LIMITANDO A, GARANTIAS DE TÍTULOS, NÃO-VIOLAÇÃO, COMERCIALIZAÇÃO E ADEQUAÇÃO"	+;
				" PARA UMA FINALIDADE EM PARTICULAR.  NENHUMA INFORMAÇÃO OU CONSELHO VERBAL OU POR ESCRITO,"			+;
				" FORNECIDOS PELA TOTVS, SEUS FUNCIONÁRIOS, DISTRIBUIDORES, REVENDEDORES OU AGENTES AUMENTARÃO O"		+;
				" ESCOPO DAS GARANTIAS ACIMA OU CRIARÃO QUALQUER GARANTIA NOVA." 											+;
				PULALINHA 																											+;
				PULALINHA 																											+;
				"LIMITAÇÃO DE RESPONSABILIDADE: MESMO QUE QUALQUER SOLUÇÃO FORNECIDA NA GARANTIA FALHE EM SEU"			+;
				" PROPÓSITO ESSENCIAL, EM NENHUM EVENTO A TOTVS TERÁ OBRIGAÇÕES POR QUALQUER DANO ESPECIAL,"			+;
				" CONSEQÜENTE, INDIRETO OU SEMELHANTE, INCLUINDO PERDA DE LUCROS OU DADOS, DERIVADOS DO USO OU"		+;
				" INABILIDADE DE USAR O SOFTWARE, OU QUAISQUER DADOS FORNECIDOS, MESMO QUE A TOTVS OU OUTRA PARTE"	+;
				" TENHA SIDO AVISADA DA POSSIBILIDADE DE TAL DANO, OU EM QUALQUER REIVINDICAÇÃO DE QUALQUER OUTRA"	+;
				" PARTE." 																											+;
				PULALINHA 																											+;
				PULALINHA 																											+;
				"ALGUMAS JURISDIÇÕES NÃO PERMITEM A LIMITAÇÃO OU EXCLUSÃO DE RESPONSABILIDADE POR DANOS INCIDENTAIS"	+;
				" OU CONSEQÜENTES; PORTANTO, A LIMITAÇÃO OU EXCLUSÃO ACIMA PODE NÃO SE APLICAR AO SEU CASO." 			+;
				PULALINHA 																											+;
				PULALINHA 																											+;
				"TERMO: Este Acordo é válido até ser terminado.  Este Acordo terminará, e a licença concedida a você"	+;
				" por este Acordo será revogada, imediatamente, sem qualquer advertência da TOTVS, se você não"		+;
				" obedecer a qualquer disposição deste Acordo. Ao término do mesmo, você deverá destruir o Software."	+;
				PULALINHA 																											+;
				PULALINHA 																											+;
				"ACORDO INTEGRAL: Este Acordo constitui o acordo integral entre você e a TOTVS, no que se refere ao"	+;
				" Software licenciado, e substitui todas as comunicações, as representações, as compreensões e os"	+;
				" acordos anteriores, verbais ou por escrito, entre você e a TOTVS relativos a este Software.  Este"	+;
				" Acordo não pode ser modificado ou renunciado, exceto por escrito e assinado por uma autoridade ou"	+;
				" outro representante autorizado de cada parte." 															+;
				PULALINHA 																											+;
				PULALINHA 																											+;
				"Se qualquer disposição for considerada inválida, todas as outras permanecerão válidas, a menos que"	+;
				" impeça o propósito de nosso Acordo.  A falha de qualquer parte em reforçar qualquer direito"			+;
				" concedido neste documento, ou em entrar em ação contra a outra parte no caso de qualquer violação,"	+;
				" não será considerada uma desistência à subseqüente execução dos direitos ou à subseqüente ação no"	+;
				" caso de futuras violações." }

oPanel   	:= oWizard:oMPanel[oWizard:nPanel]

oScrolTerm	:= TScrollBox():New(oPanel,005,005,125,291,.T.,.T.,.T.)
oCheckTerm	:= TCheckBox():New( 135,008,"Sim, li e aceito os termos acima.",bSETGET(lChkTerm)		,oPanel,150,009,,,,,,,,.T.,,,) //"Sim, li e aceito os termos acima."

 // Cria objetos para teste do Scroll   
oFont 	:= TFont():New('Courier new',,-12,.T.)   
oSay1	:= TSay():New(008,008,bTerm, oScrolTerm,,oFont,,,,.T.,CLR_BLUE,CLR_WHITE,270,900) 

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³UpdAtfTerm  ºAutor  ³Felipe Cunha       º Data ³  01/04/14  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Termo de Aceite											  		 º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function UpdAtfP4()
Local oPanel		:= Nil
Local oCheckTerm
Local oScrolTerm
Local bTerm 


bTerm := {|| 	"Esta rotina irá ajustar os Movimentos do Ativo(SN4) a partir dos parametros      	" +;
				"informado e os valores acumulados de depreciação na tabela Tipos de Ativos(SN3) 	" +;
				"gerados pela rotina Calculo Mensal(ATFA050)												" +;
				PULALINHA 																						+;
				PULALINHA 																						+; 
				"Antes de processar o ajuste tenha certeza que o backup do ambiente foi executado.	" +;
				PULALINHA 																						+;
				PULALINHA 																						+;
				"Confirma ?																					"}			

oPanel   	:= oWizard:oMPanel[oWizard:nPanel]

oScrolTerm	:= TScrollBox():New(oPanel,005,005,125,291,.T.,.T.,.T.)

 // Cria objetos para teste do Scroll   
oFont 	:= TFont():New('Courier new',,-12,.T.)   
oSay1	:= TSay():New(008,008,bTerm, oScrolTerm,,oFont,,,,.T.,CLR_BLUE,CLR_WHITE,270,900) 

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³UpdAtfTerm  ºAutor  ³Felipe Cunha       º Data ³  01/04/14  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Termo de Aceite											  		 º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function UpdAtfP3()
Local oPanel		:= Nil
Local dDataIni		:= FirstDay(dDataBase)
Local dDataFin		:= LastDay(dDataBase)

aPerg := {}
aResp := {}

oPanel   	:= oWizard:oMPanel[oWizard:nPanel]
aAdd(aPerg,{1,"Data De:"				,dDataIni,""	,"","",,50,.T.}) 				//"Periodo Inicial da Escrituração: "
aAdd(aPerg,{1,"Data Ate"				,dDataFin,""	,"","",,50,.T.}) 				//"Periodo Final da Escrituração: "
aAdd(aPerg,{3,"Seleciona Filiais"	, 1	, {"Sim", "Não"}	, 100,"", .T. })		//"Tipos de saldo"###"1-Normais"###"2-Conciliados"###"3-Não conciliados"
aResp := {dDataIni,dDataFin, 1}
ParamBox(aPerg,"",aResp,,,,,,oPanel) 

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³UpdAtfPros  ºAutor  ³Felipe Cunha       º Data ³  01/04/14  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Termo de Aceite											  		 º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function UpdAtfPros()


If aResp[3] == 1
	aSelFil := AdmGetFil()
Else
	aSelFil := {cFilAnt}
EndIf

Return .T.

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³UpdAtfTOk  ºAutor  ³Felipe Cunha       º Data ³  01/04/14  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Termo de Aceite											  		 º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function UpdAtfTOk()

Local dDataIni 	:= aResp[1] 				//Movimentos SN4 - Data De
Local dDataFim 	:= aResp[2] 				//Movimentos SN4  - Data Ate
Local cAliasQry	:= ''						//Movimentos SN4  - Qry Movimentos
Local cQuery 		:= ''						//Movimentos SN4  - Qry Movimentos
Local cOcorr		:= ''						//Movimentos SN4  - Codigo Ocorrencia
Local aValDepr 	:= AtfMultMoe(,,{|x| 0})	//Movimentos SN4  - Valor de Depreciação
Local aDadosComp 	:= {}						//Movimentos SN4  - Taxa Moeda
Local aData		:= {}						//Movimentos SN4  - Periodos de Analise
Local nX			:= 0						//Movimentos SN4  - Sequencial			
Local cTmpSN4Fi1								//Movimentos SN4  - Temporario para Filial
Local nRecnoSN4	:= 0						//Movimentos SN4  - Recno
Local aAreaSN4	
Local nInc			:= 0

Local aStruct			:= {}					//Cadastro SN3  - Estrutura Tabela Temporaria 
Local __cTmpBD		:= ''					//Cadastro SN3  - Nome Arquivo Temporario
Local cAliasQrySN3	:= ''					//Cadastro SN3  - Qry Cadastro
Local cQuerySN3 		:= ''					//Cadastro SN3  - Qry Cadastro
Local dDataDe			:= ''					//Cadastro SN3  - Data De (01/01/XXXX)
Local dDataAte		:= ''					//Cadastro SN3  - Data De (31/12/XXXX)

//-------------------------------------------------------------------------------
// Atualiza SN4
//-------------------------------------------------------------------------------

//Carrega Periodos a serem processados
While dDataFim <= aResp[2]
	 
	dDataIni 	:= FirstDay(dDataIni)
	dDataFim 	:= LastDay(dDataIni)
	
	aAdd(aData, { DTOS(dDataIni),DTOS(dDataFim) } )
	
	//Incrementa 1 mes
	dDataIni 	:= (dDataFim + 1)

	If dDataIni > aResp[2]
		Exit
	EndIf
EndDo


#IFDEF TOP

For nInc := 1 To Len( aSelFil )

	cFilAnt := aSelFil[nInc]
		
	For nX := 1 to Len(aData)

		cAliasQry 	:= GetNextAlias()
		
		If nX > 1
			cQuery += " UNION " 
			cQuery += "SELECT SN4.R_E_C_N_O_ SN4RECNO 																	"
		Else
			cQuery := "SELECT SN4.R_E_C_N_O_ SN4RECNO 																	"
		EndIf
	
		cQuery += "FROM "+RetSqlName("SN4")+" SN4 																		"	
		cQuery += "WHERE 																										"	
		cQuery += "	SN4.N4_FILIAL " + GetRngFil( aSelFil ,"SN4", .T., @cTmpSN4Fi1) + " AND						"		
		cQuery += "	SN4.N4_DATA    >= '" + aData[nX][1]  + "' AND 													"
		cQuery += "	SN4.N4_DATA    <= '" + aData[nX][2]  + "' AND 													"
		cQuery += "	SN4.N4_MOTIVO  = '  ' AND 																			"
		cQuery += "	SN4.N4_TIPOCNT = '3'  AND 																			"
		cQuery += "	SN4.D_E_L_E_T_ = ' '  AND 																			"
		cQuery += "	NOT EXISTS ( 																							"
		cQuery += "				SELECT SN4.R_E_C_N_O_ SN4RECNO	 														"
		cQuery += "				FROM "+RetSqlName("SN4")+" SN4b	 														"
		cQuery += "				WHERE 																						"
		cQuery += "				SN4b.N4_FILIAL = '" + xFilial("SN4") + "' AND											"
		cQuery += "				SN4b.N4_DATA    >= '" + aData[nX][1]   + "' AND										"
		cQuery += "				SN4b.N4_DATA    <= '" + aData[nX][2]   + "' AND										"
		cQuery += "				SN4b.N4_MOTIVO  = '  ' AND 																"
		cQuery += "				SN4b.N4_TIPOCNT = '4'  AND 																"
		cQuery += "				SN4b.D_E_L_E_T_ = ' ' AND 																"
		cQuery += "				SN4b.N4_FILIAL  = SN4.N4_FILIAL AND													"
		cQuery += "				SN4b.N4_CBASE   = SN4.N4_CBASE AND														"
		cQuery += "				SN4b.N4_ITEM    = SN4.N4_ITEM AND 														"
		cQuery += "				SN4b.N4_TIPO    = SN4.N4_TIPO  	 														"		
		cQuery += "               	 ) 																						"
	Next nX
			
	cQuery := ChangeQuery(cQuery)
	MsAguarde({|| dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasQry,.T.,.T.)},"Selecionando Registros...") 
	
	//Posiciona no primeiro registro
	( cAliasQry )->( dbGotop() )
	
	While ( cAliasQry )->( !Eof() )
		
		//cFilAnt := SN4->N4_FILAL
		
		//Posiciono o SN4 no Registro filtrado 
		SN4->(dbGoTo( ( cAliasQry )->SN4RECNO ) )
		
		//Guardo a Area
		aAreaSN4	:= SN4->( GetArea() )
		
		//Carrega valores em todas as moedas
		For nX := 1 to Len(aValDepr)
			aValDepr[nX] := SN4->&( "N4_VLROC" + cValToChar(nX) )
		Next nX
		
		//Verifica a Ocorrencia
		cOcorr := IIF( SN4->N4_TIPO $ "10,12,14,50,51,52,53,54", "20", IIF(SN4->N4_TIPO == "07","10",IIF(SN4->N4_TIPO=="08","12",IIF(SN4->N4_TIPO == "09","11","06"))))
		
		//Taxa de Depreciação
		Afill(aDadosComp, SN4->N4_TXDEPR) 
		
		//Gera Movimento Faltante
		nRecnoSN4 := SN4->(RECNO())		
		ATFXMOV(cFilAnt,SN4->N4_IDMOV,SN4->N4_DATA,cOcorr,SN4->N4_CBASE,SN4->N4_ITEM,SN4->N4_TIPO,"0",SN4->N4_SEQ,SN4->N4_SEQREAV,"4",SN4->N4_QUANTD,SN4->N4_TPSALDO,,aValDepr,aDadosComp)
		
		//Retorno a Area
		RestArea(aAreaSN4)		
		dbSelectArea( cAliasQry ) 
		
		( cAliasQry) ->(dbSkip())
	
	Enddo
	
	CtbTmpErase(cTmpSN4Fi1)
		
	//-------------------------------------------------------------------------------
	// Atualiza SN3
	//-------------------------------------------------------------------------------	
	cAliasQrySN3 := GetNextAlias()
	cQuerySN3 := "Select SN4.N4_FILIAL FILIAL,		   "
	cQuerySN3 += "  		SN4.N4_CBASE BASE,      "
	cQuerySN3 += "		SN4.N4_ITEM ITEM,       "
	cQuerySN3 += "		SN4.N4_TIPO TIPO,       "	
	cQuerySN3 += "		SN4.N4_TIPOCNT TIPOCNT, "
	cQuerySN3 += "		SUM(N4_VLROC1)VALOR1,   "
	cQuerySN3 += "		SUM(N4_VLROC2)VALOR2,   "
	cQuerySN3 += "		SUM(N4_VLROC3)VALOR3,   "
	cQuerySN3 += "		SUM(N4_VLROC4)VALOR4,   "
	cQuerySN3 += "		SUM(N4_VLROC5)VALOR5,   "
	cQuerySN3 += "		MAX(N4_DATA)DATA		   "
	cQuerySN3 += "		FROM " + RetSqlName("SN4" )+ " SN4 "// +  __cTmpBD + " TEMP "
	cQuerySN3 += "		WHERE  SN4.N4_TIPOCNT = '4' AND         "
	cQuerySN3 += "				SN4.N4_FILIAL = '" + xFilial("SN4") + "' AND "
	cQuerySN3 += "				SN4.D_E_L_E_T_ = ''           "
	cQuerySN3 += "		GROUP BY SN4.N4_FILIAL,					 " 
	cQuerySN3 += "				SN4.N4_CBASE,    		            "
	cQuerySN3 += "				SN4.N4_ITEM,                     "
	cQuerySN3 += "				SN4.N4_TIPO,                     "
	cQuerySN3 += "				SN4.N4_TIPOCNT                   "
	
	cQuerySN3 := ChangeQuery(cQuerySN3)
	MsAguarde({|| dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuerySN3),cAliasQrySN3,.T.,.T.)},"Atualizando Registros SN3...") 
	
	//Posiciona no primeiro registro
	( cAliasQrySN3 )->( dbGotop() )
	
	While ( cAliasQrySN3 )->( !Eof() )
		//If (SN4->(MsSeek( xFilial("SN4")+ (cAliasQrySN3)->BASE + (cAliasQrySN3)->ITEM + (cAliasQrySN3)->TIPO + (cAliasQrySN3)->DATA ) ) )		
			//Posiciona na SN3
			If (SN3->(MsSeek( (cAliasQrySN3)->FILIAL + (cAliasQrySN3)->BASE + (cAliasQrySN3)->ITEM + (cAliasQrySN3)->TIPO ) ) )	
				RecLock("SN3", .F.)
					//Atualiza Valor de Depreciação Acumulada
					SN3->N3_VRDACM1 := (cAliasQrySN3)->VALOR1
					SN3->N3_VRDACM2 := (cAliasQrySN3)->VALOR2
					SN3->N3_VRDACM3 := (cAliasQrySN3)->VALOR3
					SN3->N3_VRDACM4 := (cAliasQrySN3)->VALOR4
					SN3->N3_VRDACM5 := (cAliasQrySN3)->VALOR5
					
					/*
					//Atualiza Valor da Ultima Depreciação
					SN3->N3_VRDMES1 :=  SN4->N4_VLROC1
					SN3->N3_VRDMES2 :=  SN4->N4_VLROC2
					SN3->N3_VRDMES3 :=  SN4->N4_VLROC3
					SN3->N3_VRDMES4 :=  SN4->N4_VLROC4
					SN3->N3_VRDMES5 :=  SN4->N4_VLROC5
					*/				
				MsUnlock() 
			EndIf
			( cAliasQrySN3) ->(dbSkip())
		//EndIf
	EndDo
	
	CtbTmpErase(cTmpSN4Fi1)
	
	
	
    //Atualiza Valor Acumulado após a ultima virada Anual
    //Primeiro e Ultimo dia do Ano
    dDataDe	:= AllTrim( STR( YEAR( dDataBase ) ) ) + '0101'
    dDataAte 	:= AllTrim( STR( YEAR( dDataBase ) ) ) + '1231'
    cQuerySN3 := ''
    
    cAliasQrySN3 := GetNextAlias()
	cQuerySN3 := "Select  SN4.N4_FILIAL FILIAL,		   							"
	cQuerySN3 += "  		 SN4.N4_CBASE BASE,      						"
	cQuerySN3 += "		 SN4.N4_ITEM    ITEM,							"
	cQuerySN3 += "		 SN4.N4_TIPO    TIPO,    						"		    
	cQuerySN3 += "		 SN4.N4_TIPOCNT TIPOCNT,							"
	cQuerySN3 += "		 Sum(SN4.N4_VLROC1) VALOR1,						"
	cQuerySN3 += "		 Sum(SN4.N4_VLROC2) VALOR2,						"
	cQuerySN3 += "		 Sum(SN4.N4_VLROC3) VALOR3,						"
	cQuerySN3 += "		 Sum(SN4.N4_VLROC4) VALOR4,						"
	cQuerySN3 += "		 Sum(SN4.N4_VLROC5) VALOR5						"
	//cQuerySN3 += "		 FROM SN4010 SN4									"
	cQuerySN3 += "		FROM " + RetSqlName("SN4" )+ " SN4 			"
	cQuerySN3 += "		 WHERE  SN4.N4_TIPOCNT = '4'					"
	cQuerySN3 += "			 AND SN4.N4_FILIAL = '" + xFilial("SN4") + "'"	
	cQuerySN3 += "		    AND SN4.D_E_L_E_T_ = ''						"
	cQuerySN3 += "		    AND SN4.N4_DATA    >= '" + dDataDe  + "'	"
	cQuerySN3 += "		    AND SN4.N4_DATA    <= '" + dDataAte + "'	"
	cQuerySN3 += "		GROUP BY SN4.N4_FILIAL,					 		" 
	cQuerySN3 += "				SN4.N4_CBASE,    		           		"
	cQuerySN3 += "				SN4.N4_ITEM,								"
	cQuerySN3 += "				SN4.N4_TIPO,								"	
	cQuerySN3 += "				SN4.N4_TIPOCNT  							"
	
	
	cQuerySN3 := ChangeQuery(cQuerySN3)
	MsAguarde({|| dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuerySN3),cAliasQrySN3b,.T.,.T.)},"Atualizando Registros SN3...") 
	
	//Posiciona no primeiro registro
	( cAliasQrySN3b )->( dbGotop() )
	
	While ( cAliasQrySN3b )->( !Eof() )		
		//Posiciona na SN3
		If (SN3->(MsSeek( (cAliasQrySN3)->FILIAL + (cAliasQrySN3b)->BASE + (cAliasQrySN3b)->ITEM + (cAliasQrySN3b)->TIPO ) ) )	
			RecLock("SN3", .F.)
	
			//Atualiza Valor Acumulado após a ultima virada Anual
			SN3->N3_VRDBAL1 := (cAliasQrySN3b)->VALOR1
			SN3->N3_VRDBAL2 := (cAliasQrySN3b)->VALOR2 
			SN3->N3_VRDBAL3 := (cAliasQrySN3b)->VALOR3
			SN3->N3_VRDBAL4 := (cAliasQrySN3b)->VALOR4
			SN3->N3_VRDBAL5 := (cAliasQrySN3b)->VALOR5
			
			MsUnlock() 
		EndIf
		( cAliasQrySN3b) ->(dbSkip())
	EndDo
	
	CtbTmpErase(cTmpSN4Fi1)
	
Next nInc
#ENDIF

Alert("Processo Finalizado com sucesso!!")		
	

Return .T.